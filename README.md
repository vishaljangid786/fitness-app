# Client (Expo) — README

This document explains the client (mobile) side of the Fitness App. It describes project layout, how to run and develop the Expo Router app, component conventions, integration points (Sanity + Clerk), environment variables, and troubleshooting tips.

---

## Table of contents

- Overview
- Quick start
- Project layout (important files)
- Key components and hooks
- Navigation and routing
- Data & Sanity integration (where it lives)
- Authentication (Clerk)
- Styling & assets
- Scripts & common commands
- Troubleshooting
- Roadmap / next steps

---

## Overview

- Client framework: Expo (Managed workflow) with Expo Router.
- Navigation: File-based routes and nested tab groups in `src/app`.
- Styling: Tailwind via NativeWind and global CSS (`src/app/global.css`).
- Content: Sanity (GROQ) used to populate exercises and workouts.
- Auth: Clerk for auth flows and secure session management.

The mobile app lives in `src/app` with small reusable components in `src/app/components` and helper utilities in `src/lib`.

---

## Quick start

1. Install dependencies:

```powershell
cd client
npm install
```

2. Populate `.env` at the repo root (or in the `client` folder if you isolate variables):

```text
EXPO_PUBLIC_CLERK_PUBLISHABLE_KEY=pk_test_...
SANITY_API_TOKEN=sk_...          # only if you need server-side write access from the app (admin client)
```

3. Start the app:

```powershell
npm run start
# or specific platforms
npm run android
npm run ios
npm run web
```

4. (Optional) Start Sanity Studio in a separate terminal to manage content:

```powershell
cd sanity
npm run dev
```

---

## Project layout (important files)

Top-level client files:

- `src/app/_layout.tsx` — app-level provider (Clerk) and global CSS import.
- `src/app/(app)/_layout.tsx` — protected routes layout (guards tabs behind auth).
- `src/app/(app)/(tabs)/_layout.tsx` — tab navigator configuration and icons.
- `src/app/(app)/(tabs)/exercises.tsx` — exercise list screen.
- `src/app/(app)/(tabs)/workout.tsx` — start workout screen.
- `src/app/exercise-detail.tsx` — exercise modal details.
- `src/app/components/ExerciseCard.tsx` — reusable card for exercise items.
- `src/lib/sanity/client.ts` — Sanity client + `urlFor` helper.
- `src/lib/sanity/types.ts` — generated types for Sanity documents.

Folder conventions:

- `components/`: presentational and reusable UI components.
- `lib/`: 3rd-party client configs and utilities.
- `app/(app)/(tabs)`: grouped screens that require authentication.

---

## Key components and hooks

- `ExerciseCard` — displays exercise thumbnail (Sanity image), title, difficulty chip, and optional chevron. Use it inside lists.
- `GoogleSignIn` — helper component that triggers Clerk's Google SSO flow.
- `useUser()` / `useAuth()` from `@clerk/clerk-expo` — use these in protected screens to obtain user info and signOut.

Tips:

- Keep components small and stateless where possible; pass handlers from screens for navigation or side-effects.
- Store local UI state in component hooks and lift persistent state (workout progress) to a service or context if needed.

---

## Navigation and routing

This project uses Expo Router's file-based routing. Key rules:

- Files in `src/app` map to routes. Group directories like `(tabs)` are used to organize screens and control nesting.
- Use `useRouter()` from `expo-router` to navigate programmatically, prefer relative routes (e.g., `router.push('active-workout')`) when navigating inside the same group to avoid mismatched absolute routes.
- To hide tab bar on certain screens (like `active-workout`), `_layout.tsx` for tabs can set `tabBarStyle: { display: 'none' }` for specific `Tabs.Screen` entries.

Common gotchas:

- Leading slashes in `router.push('/active-workout')` may not resolve as expected if screens are nested in grouped folders — use relative names when in doubt.

---

## Data & Sanity integration

- Sanity client: `src/lib/sanity/client.ts` exports `client` and `urlFor()` helpers.
- Queries: GROQ queries are defined close to screens (e.g., `exercisesQuery` in `exercises.tsx`). Keep queries small and explicit.
- Types: `src/lib/sanity/types.ts` is generated by the Sanity typegen task — run `npm run typegen` in `/sanity` after schema changes.

Best practices:

- Use projection (`{name, difficulty, image{asset->{_ref}}}`) to only fetch required fields.
- Handle empty states and network errors gracefully; always `try/catch` around `client.fetch()`.

---

## Authentication (Clerk)

- The app uses `@clerk/clerk-expo`. The top-level `src/app/_layout.tsx` and the protected `(app)` layout enforce and provide session context.
- Use `useUser()` to get the current user and `useAuth()` for signOut and session actions.
- Ensure `EXPO_PUBLIC_CLERK_PUBLISHABLE_KEY` is set in your environment.

Notes on dev:

- Clerk often uses redirect flows for OAuth; on mobile, these are handled via SafariViewController / Custom tabs — ensure `expo-web-browser` is installed and available in your runtime (Expo Go usually supports this; custom dev clients require a rebuild).

---

## Styling & assets

- Tailwind via `nativewind` is configured in `tailwind.config.js` and used with `className` in components.
- Fonts and global CSS are loaded from `src/app/global.css`.
- Images: Sanity-hosted images use `urlFor(...)` which builds CDN URLs. For local assets, place them in `src/app/images` and load via `require()`.

---

## Scripts & common commands

Run these from the `client` folder:

- `npm run start` — start Expo dev server
- `npm run android` — open Android device/emulator
- `npm run ios` — open iOS simulator (macOS only)
- `npm run web` — run web build locally
- `npm run deploy` — exported web build + EAS deploy (configured in root package.json)

Helpful debugging:

- Clear Metro cache: `npm run start -- --clear` or `npx expo start -c`.
- Show device logs: `npx expo log --device` or use your emulator logs.

---

## Troubleshooting

- **Navigation not opening a screen**: Use relative `router.push('route-name')` inside grouped routes; check `src/app/(app)/(tabs)/_layout.tsx` for the `Tabs.Screen` name.
- **`expo-web-browser` errors**: install the package (`expo install expo-web-browser`) and restart Metro; custom dev clients require a rebuild.
- **Sanity data not appearing**: confirm documents are published in the correct dataset and `client.fetch` queries the same dataset; regenerate types after schema changes.
- **Clerk auth issues**: verify `EXPO_PUBLIC_CLERK_PUBLISHABLE_KEY` and that your Clerk app allows the platform (mobile redirect URIs for OAuth).
- **Style missing / className ignored**: ensure `nativewind` is installed and `babel.config.js` includes the NativeWind plugin.

---

## Roadmap / next steps

- Implement `getAiGuidance` using `openai` for personalized exercise tips.
- Add a local mock provider for offline development when Sanity is unavailable.
- Add unit and integration tests for components and screens.

---

If you'd like, I can also:

- Scaffold a `src/app/examples` folder with a working mock data flow for offline development.
- Add a `.env.example` file tailored to the client and a short script to validate env variables at startup.

---

Enjoy working on the client — tell me which next scaffold or change you want and I'll implement it.
